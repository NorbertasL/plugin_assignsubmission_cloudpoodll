{"version":3,"file":"standardtranscript.min.js","sources":["../src/standardtranscript.js"],"sourcesContent":["define(['jquery','core/log','core/str','core/ajax','core/notification', './copy_to_clipboard'],\n    function($,log,str,Ajax,notification) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Standard Transcript: initialising');\n\n    return {\n\n        init: function(opts){\n\n            var component= opts['component'];\n            var playerid= opts['playerid'];\n            var containerid= opts['containerid'];\n            var cssprefix= opts['cssprefix'];\n            var config={};\n            config.settings ={};\n            if(playerid && $('#' + playerid).length) {\n                config.component = component;\n                config.container =$('#' + containerid);\n                config.prefix = cssprefix;\n                config.player = $('#' + playerid)[0];\n                config.transcripturl = opts['transcripturl'];\n                config.title = M.util.get_string('transcripttitle',component);\n                config.assignmentid = opts['assignmentid'];\n                this.fetch_transcript(config);\n            }\n        },\n\n        copybutton: function(target) {\n            return '<a href=\"javascript:void()\" class=\"fa fa-copy\" data-action=\"copy\" data-clipboard-target=\"#' + target + '\"></a>';\n        },\n\n        fetch_transcript: function(config){\n            var that = this;\n            var header = '<header class=\"' + config.prefix + '-header\">' +config.title+'</header>';\n            var textcontainer = $('<p id=\"' + config.prefix + '-text\" class=\"' + config.prefix + '-text\"></p>');\n\n            textcontainer.load(config.transcripturl,function(){\n                config.transcripttext = textcontainer.text();\n                config.container.prepend(header);\n                config.container.append(textcontainer.append(that.copybutton(config.prefix + '-text')));\n                //This is a prototype fetch corrections button\n               that.prepare_corrections_button(config);\n            });\n        },\n\n        prepare_corrections_button: function(config){\n            var that = this;\n            var button = '<a class=\"btn btn-standard\" href=\"#\" data-action=\"getcorrection\">fetch corrections</a>';\n            var onetimeloaded = false;\n            config.button =  config.container.append(button);\n            config.textcontainer = $('<code class=\"' + config.prefix + '-difftext\"></code>').appendTo(config.container);\n            $(config.container).on('click', '[data-action=\"getcorrection\"]', function(e){\n                e.preventDefault();\n                if (!onetimeloaded) {\n                    that.fetch_corrections(config);\n                    onetimeloaded = true;\n                }\n            });\n        },\n\n        fetch_corrections: function(config){\n            var that = this;\n            //do the check\n            var text = config.transcripttext;\n            //but quit if its empty\n            if(!text || text==='' || text.trim()===''){\n                return;\n            }\n\n            config.textcontainer.html('');\n\n            Ajax.call([{\n                methodname: 'assignsubmission_cloudpoodll_check_grammar',\n                args: {\n                    assignmentid: config.assignmentid,\n                    text: text\n\n                },\n                done: function (ajaxresult) {\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        config.textcontainer.html(payloadobject.diffhtml);\n                        config.textcontainer.append('<textarea style=\"display: none\" id =\"' + config.prefix + '-difftext\">' +\n                            payloadobject.corrections + '</textarea>');\n                        config.textcontainer.append(that.copybutton(config.prefix + '-difftext'));\n                    }else{\n                        //something went wrong\n                        config.textcontainer.html('could not fetch corrections');\n                        log.debug('result not fetched');\n                    }\n\n                },\n                fail: notification.exception\n            }]);\n        }\n\n    };//end of return object\n});"],"names":["define","$","log","str","Ajax","notification","debug","init","opts","component","playerid","containerid","cssprefix","config","length","container","prefix","player","transcripturl","title","M","util","get_string","assignmentid","fetch_transcript","copybutton","target","that","this","header","textcontainer","load","transcripttext","text","prepend","append","prepare_corrections_button","onetimeloaded","button","appendTo","on","e","preventDefault","fetch_corrections","trim","html","call","methodname","args","done","ajaxresult","payloadobject","JSON","parse","diffhtml","corrections","fail","exception"],"mappings":"AAAAA,yDAAO,CAAC,SAAS,WAAW,WAAW,YAAY,oBAAqB,wBACpE,SAASC,EAAEC,IAAIC,IAAIC,KAAKC,qBAGxBH,IAAII,MAAM,qCAEH,CAEHC,KAAM,SAASC,UAEPC,UAAWD,KAAI,UACfE,SAAUF,KAAI,SACdG,YAAaH,KAAI,YACjBI,UAAWJ,KAAI,UACfK,OAAO,CACXA,SAAiB,IACdH,UAAYT,EAAE,IAAMS,UAAUI,SAC7BD,OAAOJ,UAAYA,UACnBI,OAAOE,UAAWd,EAAE,IAAMU,aAC1BE,OAAOG,OAASJ,UAChBC,OAAOI,OAAShB,EAAE,IAAMS,UAAU,GAClCG,OAAOK,cAAgBV,KAAI,cAC3BK,OAAOM,MAAQC,EAAEC,KAAKC,WAAW,kBAAkBb,WACnDI,OAAOU,aAAef,KAAI,kBACrBgB,iBAAiBX,UAI9BY,WAAY,SAASC,cACV,6FAA+FA,OAAS,UAGnHF,iBAAkB,SAASX,YACnBc,KAAOC,KACPC,OAAS,kBAAoBhB,OAAOG,OAAS,YAAaH,OAAOM,MAAM,YACvEW,cAAgB7B,EAAE,UAAYY,OAAOG,OAAS,iBAAmBH,OAAOG,OAAS,eAErFc,cAAcC,KAAKlB,OAAOK,eAAc,WACpCL,OAAOmB,eAAiBF,cAAcG,OACtCpB,OAAOE,UAAUmB,QAAQL,QACzBhB,OAAOE,UAAUoB,OAAOL,cAAcK,OAAOR,KAAKF,WAAWZ,OAAOG,OAAS,WAE9EW,KAAKS,2BAA2BvB,YAIvCuB,2BAA4B,SAASvB,YAC7Bc,KAAOC,KAEPS,eAAgB,EACpBxB,OAAOyB,OAAUzB,OAAOE,UAAUoB,OAFrB,0FAGbtB,OAAOiB,cAAgB7B,EAAE,gBAAkBY,OAAOG,OAAS,sBAAsBuB,SAAS1B,OAAOE,WACjGd,EAAEY,OAAOE,WAAWyB,GAAG,QAAS,iCAAiC,SAASC,GACtEA,EAAEC,iBACGL,gBACDV,KAAKgB,kBAAkB9B,QACvBwB,eAAgB,OAK5BM,kBAAmB,SAAS9B,YACpBc,KAAOC,KAEPK,KAAOpB,OAAOmB,eAEdC,MAAe,KAAPA,MAA2B,KAAdA,KAAKW,SAI9B/B,OAAOiB,cAAce,KAAK,IAE1BzC,KAAK0C,KAAK,CAAC,CACPC,WAAY,6CACZC,KAAM,CACFzB,aAAcV,OAAOU,aACrBU,KAAMA,MAGVgB,KAAM,SAAUC,gBACRC,cAAgBC,KAAKC,MAAMH,YAC3BC,eACAtC,OAAOiB,cAAce,KAAKM,cAAcG,UACxCzC,OAAOiB,cAAcK,OAAO,wCAA0CtB,OAAOG,OAAS,cAClFmC,cAAcI,YAAc,eAChC1C,OAAOiB,cAAcK,OAAOR,KAAKF,WAAWZ,OAAOG,OAAS,gBAG5DH,OAAOiB,cAAce,KAAK,+BAC1B3C,IAAII,MAAM,wBAIlBkD,KAAMnD,aAAaoD"}