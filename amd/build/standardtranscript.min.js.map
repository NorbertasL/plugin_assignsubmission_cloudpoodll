{"version":3,"file":"standardtranscript.min.js","sources":["../src/standardtranscript.js"],"sourcesContent":["define(['jquery','core/log','core/str','core/ajax','core/notification', './copy_to_clipboard'],\n    function($,log,str,Ajax,notification) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Standard Transcript: initialising');\n\n    return {\n\n        init: function(opts){\n\n            var component= opts['component'];\n            var playerid= opts['playerid'];\n            var containerid= opts['containerid'];\n            var cssprefix= opts['cssprefix'];\n            var config={};\n            config.settings ={};\n            if(playerid && $('#' + playerid).length) {\n                config.component = component;\n                config.container =$('#' + containerid);\n                config.prefix = cssprefix;\n                config.player = $('#' + playerid)[0];\n                config.transcripturl = opts['transcripturl'];\n                config.title = M.util.get_string('transcripttitle',component);\n                config.assignmentid = opts['assignmentid'];\n                this.fetch_transcript(config);\n            }\n        },\n\n\n\n        fetch_transcript: function(config){\n            var that = this;\n            var header = '<header class=\"' + config.prefix + '-header\">' +config.title+'</header>';\n            var textcontainer = $('<p id=\"' + config.prefix + '-text\" class=\"' + config.prefix + '-text\"></p>');\n\n            textcontainer.load(config.transcripturl,function(){\n                config.transcripttext = textcontainer.text();\n                config.container.prepend(header);\n                config.container.append(textcontainer);\n\n                var copybutton = that.prepare_copy_button(config.prefix + '-text');\n                var correctionsbutton = that.prepare_corrections_button(config);\n                config.container.append('<div class=\"assignsubmission_cloudpoodll_actionbar\">' + copybutton + correctionsbutton + '</div>');\n\n\n            });\n        },\n\n        prepare_copy_button: function(target) {\n            return '<a href=\"javascript:void()\" data-action=\"copy\" data-clipboard-target=\"#' + target + '\"><i class=\"fa fa-copy\"></i></a>';\n        },\n\n        prepare_corrections_button: function(config){\n            var that = this;\n\n            var onetimeloaded = false;\n           // config.button =  config.container.append(button);\n\n            $(config.container).on('click', '[data-action=\"getcorrection\"]', function(e){\n                e.preventDefault();\n                if (!onetimeloaded) {\n                    that.fetch_corrections(config);\n                    onetimeloaded = true;\n                }\n            });\n            var button = '<a href=\"javascript:void()\" data-action=\"getcorrection\"><i class=\"fa fa-check\"></a>';\n            return button;\n        },\n\n        fetch_corrections: function(config){\n            var that = this;\n            //do the check\n            var text = config.transcripttext;\n            //but quit if its empty\n            if(!text || text==='' || text.trim()===''){\n                return;\n            }\n            config.correctionscontainer = $('<code class=\"' + config.prefix + '-difftext\"></code>').appendTo(config.container);\n\n            Ajax.call([{\n                methodname: 'assignsubmission_cloudpoodll_check_grammar',\n                args: {\n                    assignmentid: config.assignmentid,\n                    text: text\n\n                },\n                done: function (ajaxresult) {\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        config.correctionscontainer.html(payloadobject.diffhtml);\n                        config.correctionscontainer.append('<textarea style=\"display: none\" id =\"' + config.prefix + '-difftext\">' +\n                            payloadobject.corrections + '</textarea>');\n                        var copybutton =that.prepare_copy_button(config.prefix + '-difftext')\n\n                        config.correctionscontainer.append('<div class=\"assignsubmission_cloudpoodll_actionbar\">' + copybutton +  '</div>');\n                    }else{\n                        //something went wrong\n                        config.textcontainer.html('could not fetch corrections');\n                        log.debug('result not fetched');\n                    }\n\n                },\n                fail: notification.exception\n            }]);\n        }\n\n    };//end of return object\n});"],"names":["define","$","log","str","Ajax","notification","debug","init","opts","component","playerid","containerid","cssprefix","config","length","container","prefix","player","transcripturl","title","M","util","get_string","assignmentid","fetch_transcript","that","this","header","textcontainer","load","transcripttext","text","prepend","append","copybutton","prepare_copy_button","correctionsbutton","prepare_corrections_button","target","onetimeloaded","on","e","preventDefault","fetch_corrections","trim","correctionscontainer","appendTo","call","methodname","args","done","ajaxresult","payloadobject","JSON","parse","html","diffhtml","corrections","fail","exception"],"mappings":"AAAAA,yDAAO,CAAC,SAAS,WAAW,WAAW,YAAY,oBAAqB,wBACpE,SAASC,EAAEC,IAAIC,IAAIC,KAAKC,qBAGxBH,IAAII,MAAM,qCAEH,CAEHC,KAAM,SAASC,UAEPC,UAAWD,KAAI,UACfE,SAAUF,KAAI,SACdG,YAAaH,KAAI,YACjBI,UAAWJ,KAAI,UACfK,OAAO,CACXA,SAAiB,IACdH,UAAYT,EAAE,IAAMS,UAAUI,SAC7BD,OAAOJ,UAAYA,UACnBI,OAAOE,UAAWd,EAAE,IAAMU,aAC1BE,OAAOG,OAASJ,UAChBC,OAAOI,OAAShB,EAAE,IAAMS,UAAU,GAClCG,OAAOK,cAAgBV,KAAI,cAC3BK,OAAOM,MAAQC,EAAEC,KAAKC,WAAW,kBAAkBb,WACnDI,OAAOU,aAAef,KAAI,kBACrBgB,iBAAiBX,UAM9BW,iBAAkB,SAASX,YACnBY,KAAOC,KACPC,OAAS,kBAAoBd,OAAOG,OAAS,YAAaH,OAAOM,MAAM,YACvES,cAAgB3B,EAAE,UAAYY,OAAOG,OAAS,iBAAmBH,OAAOG,OAAS,eAErFY,cAAcC,KAAKhB,OAAOK,eAAc,WACpCL,OAAOiB,eAAiBF,cAAcG,OACtClB,OAAOE,UAAUiB,QAAQL,QACzBd,OAAOE,UAAUkB,OAAOL,mBAEpBM,WAAaT,KAAKU,oBAAoBtB,OAAOG,OAAS,SACtDoB,kBAAoBX,KAAKY,2BAA2BxB,QACxDA,OAAOE,UAAUkB,OAAO,uDAAyDC,WAAaE,kBAAoB,cAM1HD,oBAAqB,SAASG,cACnB,0EAA4EA,OAAS,oCAGhGD,2BAA4B,SAASxB,YAC7BY,KAAOC,KAEPa,eAAgB,EAGpBtC,EAAEY,OAAOE,WAAWyB,GAAG,QAAS,iCAAiC,SAASC,GACtEA,EAAEC,iBACGH,gBACDd,KAAKkB,kBAAkB9B,QACvB0B,eAAgB,YAGX,uFAIjBI,kBAAmB,SAAS9B,YACpBY,KAAOC,KAEPK,KAAOlB,OAAOiB,eAEdC,MAAe,KAAPA,MAA2B,KAAdA,KAAKa,SAG9B/B,OAAOgC,qBAAuB5C,EAAE,gBAAkBY,OAAOG,OAAS,sBAAsB8B,SAASjC,OAAOE,WAExGX,KAAK2C,KAAK,CAAC,CACPC,WAAY,6CACZC,KAAM,CACF1B,aAAcV,OAAOU,aACrBQ,KAAMA,MAGVmB,KAAM,SAAUC,gBACRC,cAAgBC,KAAKC,MAAMH,eAC3BC,cAAe,CACfvC,OAAOgC,qBAAqBU,KAAKH,cAAcI,UAC/C3C,OAAOgC,qBAAqBZ,OAAO,wCAA0CpB,OAAOG,OAAS,cACzFoC,cAAcK,YAAc,mBAC5BvB,WAAYT,KAAKU,oBAAoBtB,OAAOG,OAAS,aAEzDH,OAAOgC,qBAAqBZ,OAAO,uDAAyDC,WAAc,eAG1GrB,OAAOe,cAAc2B,KAAK,+BAC1BrD,IAAII,MAAM,uBAIlBoD,KAAMrD,aAAasD"}