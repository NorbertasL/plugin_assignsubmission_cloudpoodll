define(["jquery","core/log","core/str","core/ajax","core/notification","./copy_to_clipboard"],(function($,log,str,Ajax,notification){return log.debug("Standard Transcript: initialising"),{init:function(opts){var component=opts.component,playerid=opts.playerid,containerid=opts.containerid,cssprefix=opts.cssprefix,config={settings:{}};playerid&&$("#"+playerid).length&&(config.component=component,config.container=$("#"+containerid),config.prefix=cssprefix,config.player=$("#"+playerid)[0],config.transcripturl=opts.transcripturl,config.title=M.util.get_string("transcripttitle",component),config.assignmentid=opts.assignmentid,this.fetch_transcript(config))},copybutton:function(target){return'<a href="javascript:void()" class="fa fa-copy" data-action="copy" data-clipboard-target="#'+target+'"></a>'},fetch_transcript:function(config){var that=this,header='<header class="'+config.prefix+'-header">'+config.title+"</header>",textcontainer=$('<p id="'+config.prefix+'-text" class="'+config.prefix+'-text"></p>');textcontainer.load(config.transcripturl,(function(){config.transcripttext=textcontainer.text(),config.container.prepend(header),config.container.append(textcontainer.append(that.copybutton(config.prefix+"-text"))),that.prepare_corrections_button(config)}))},prepare_corrections_button:function(config){var that=this,onetimeloaded=!1;config.button=config.container.append('<a class="btn btn-standard" href="#" data-action="getcorrection">fetch corrections</a>'),config.textcontainer=$('<code class="'+config.prefix+'-difftext"></code>').appendTo(config.container),$(config.container).on("click",'[data-action="getcorrection"]',(function(e){e.preventDefault(),onetimeloaded||(that.fetch_corrections(config),onetimeloaded=!0)}))},fetch_corrections:function(config){var that=this,text=config.transcripttext;text&&""!==text&&""!==text.trim()&&(config.textcontainer.html(""),Ajax.call([{methodname:"assignsubmission_cloudpoodll_check_grammar",args:{assignmentid:config.assignmentid,text:text},done:function(ajaxresult){var payloadobject=JSON.parse(ajaxresult);payloadobject?(config.textcontainer.html(payloadobject.diffhtml),config.textcontainer.append('<textarea style="display: none" id ="'+config.prefix+'-difftext">'+payloadobject.corrections+"</textarea>"),config.textcontainer.append(that.copybutton(config.prefix+"-difftext"))):(config.textcontainer.html("could not fetch corrections"),log.debug("result not fetched"))},fail:notification.exception}]))}}}));

//# sourceMappingURL=standardtranscript.min.js.map