{"version":3,"sources":["../src/submissionhelper.js"],"names":["define","$","log","cloudpoodll","str","debug","uploadstate","togglestate","strings","init","opts","component","register_controls","register_events","setup_recorder","that","recorder_callback","evt","type","action","controls","updatecontrol","val","mediaurl","alert","message","deletebutton","currentcontainer","togglecontainer","togglebutton","toggletext","get_string","done","s","click","confirm","M","util","html","toggle_currentsubmission","toggle","duration","complete","doToggleState","removeClass","addClass","text"],"mappings":"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","sourcesContent":["define(['jquery','core/log','assignsubmission_cloudpoodll/cloudpoodllloader',\"core/str\"], function($,log,cloudpoodll,str) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('submission helper: initialising');\n\n    return {\n\n        uploadstate: false,\n        togglestate: 0,\n        strings: {},\n\n\n        init:  function(opts) {\n            this.component = opts['component'];\n\n            this.register_controls();\n            this.register_events();\n            this.setup_recorder();\n        },\n\n        setup_recorder: function(){\n            var that = this;\n            var recorder_callback = function(evt){\n                switch(evt.type){\n                    case 'recording':\n                        if(evt.action==='started'){\n                            that.controls.updatecontrol.val();\n                        }\n                        break;\n                    case 'awaitingprocessing':\n                        if(that.uploadstate!='posted') {\n                            that.controls.updatecontrol.val(evt.mediaurl);\n                        }\n                        that.uploadstate='posted';\n                        break;\n                    case 'error':\n                        alert('PROBLEM:' + evt.message);\n                        break;\n                }\n            };\n\n            cloudpoodll.init(this.component + '_therecorder',recorder_callback);\n        },\n\n\n        register_controls: function(){\n          var that=this;\n          this.controls={};\n          this.controls.deletebutton = $('.' + this.component + '_deletesubmissionbutton');\n          this.controls.updatecontrol =  $('#' + this.component + '_updatecontrol');\n          this.controls.currentcontainer =  $('.' + this.component + '_currentsubmission');\n          this.controls.togglecontainer =  $('.' + this.component + '_togglecontainer');\n          this.controls.togglebutton =  $('.' + this.component + '_togglecontainer .togglebutton');\n          this.controls.toggletext =  $('.' + this.component + '_togglecontainer .toggletext');\n            str.get_string('clicktohide',that.component).done(function(s) {\n                that.strings['clicktohide']=s;\n            });\n            str.get_string('clicktoshow',that.component).done(function(s) {\n                that.strings['clicktoshow']=s;\n            });\n        },\n\n        register_events: function(){\n            var that =this;\n            this.controls.deletebutton.click(function(){\n                if(that.controls.updatecontrol){\n                    if(confirm(M.util.get_string('reallydeletesubmission',that.component))){\n                        that.controls.updatecontrol.val(-1);\n                        that.controls.currentcontainer.html('');\n                    }\n                }\n            });\n            this.controls.togglebutton.click(function(){that.toggle_currentsubmission(that);});\n            this.controls.toggletext.click(function(){that.toggle_currentsubmission(that);});\n        },\n\n        toggle_currentsubmission: function(that){\n            var doToggleState = function(){\n                if(that.togglestate==0){\n                    that.controls.togglebutton.removeClass('fa-toggle-off');\n                    that.controls.togglebutton.addClass('fa-toggle-on');\n                    that.controls.toggletext.text(that.strings['clicktohide']);\n                    that.togglestate=1;\n                }else{\n                    that.controls.togglebutton.removeClass('fa-toggle-on');\n                    that.controls.togglebutton.addClass('fa-toggle-off');\n                    that.controls.toggletext.text(that.strings['clicktoshow']);\n                    that.togglestate=0;\n                }\n            };\n            that.controls.currentcontainer.toggle(\n                {duration: 300, complete: doToggleState}\n            );\n            return false;\n        }\n    };//end of return object\n});"],"file":"submissionhelper.min.js"}